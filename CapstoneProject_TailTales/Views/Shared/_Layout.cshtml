<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sedan:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

    <!--Fine fonts -->
    <title>@ViewBag.Title - TailTales</title>
    @Styles.Render("~/Content/Site.css")
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
    <!--1. Sidebar
        2. Navbar
        3. Main content
        4. Footer
        -->
    <header>
        <!-- 1. Sidebar -->
        <nav id="sidebarMenu" class="collapse d-lg-block sidebar collapse bg-light position-fixed position-fixed h-100">
            <div class="mt-3 position-sticky">
                <div class="list-group list-group-flush">
                    <ul class="mt-3  py-1 list-unstyled px-1 flex-column align-content-around text-center">
                        <li class="nav-item my-3 py-1">
                            <a class="navbar-brand" href="@Url.Action("Index", "Home")">
                                <img src="https://alipg.altervista.org/TailTales/home.svg" alt="Home" height="45" type="image/svg+xml" />
                            </a>
                            <p>Home</p>
                        </li>
                        <li class="nav-item my-3 py-1">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <a class="navbar-brand" href="@Url.Action("Explore", "Home")">
                                    <img src="https://alipg.altervista.org/TailTales/PetExplores.svg" alt="Naviga" height="45" type="image/svg+xml" />
                                </a><p>Naviga</p>
                            }
                            else
                            {
                                <a class="navbar-brand" href="@Url.Action("Index", "Home")">
                                    <img src="https://alipg.altervista.org/TailTales/PetExplores.svg" alt="Naviga" height="45" type="image/svg+xml" />
                                </a><p>Naviga</p>
                            }
                        </li>
                        <li class="nav-item my-3 py-1">
                            @if (User.Identity.IsAuthenticated)
                            {
                                int userId;
                                string userIdCookieValue = Request.Cookies["IDUserCookie"]?.Value;
                                bool isUserIdValid = int.TryParse(userIdCookieValue, out userId);
                                <a class="navbar-brand py-0" href="@Url.Action("Index", "Pet", new { id = userId })">
                                    <img src="https://alipg.altervista.org/TailTales/pets.svg" alt="My Pets" height="45" type="image/svg+xml" />
                                </a>
                                <p>I Miei Pets</p>
                            }
                            else
                            {
                                <a class="navbar-brand" href="@Url.Action("Login", "Utenti")">
                                    <img src="https://alipg.altervista.org/TailTales/pets.svg" alt="My Pets" height="45" type="image/svg+xml" />
                                </a>
                                <p>I Miei Pets</p>
                            }
                        </li>
                        <li class="nav-item my-3 py-1">
                            @if (User.Identity.IsAuthenticated)
                            {
                                int userId;
                                string userIdCookieValue = Request.Cookies["IDUserCookie"]?.Value;
                                bool isUserIdValid = int.TryParse(userIdCookieValue, out userId);
                                <a class="navbar-brand py-0" href="@Url.Action("Index", "AlbumFoto", new { id = userId })">
                                    <img src="https://alipg.altervista.org/TailTales/album.svg" alt="Album" height="45" type="image/svg+xml" />
                                </a>
                                <p>Album</p>
                            }
                            else
                            {
                                <a class="navbar-brand py-0" href="@Url.Action("Login", "Utenti")">
                                    <img src="https://alipg.altervista.org/TailTales/album.svg" alt="Album" height="45" type="image/svg+xml" />
                                </a>
                                <p>Album</p>
                            }

                        </li>
                        <li class="nav-item my-3 py-1">
                            @{
                                if (User.Identity.IsAuthenticated)
                                {
                                    int userId;
                                    string userIdCookieValue = Request.Cookies["IDUserCookie"]?.Value;
                                    bool isUserIdValid = int.TryParse(userIdCookieValue, out userId);
                                    <a class="navbar-brand py-0" href="@Url.Action("Details", "Utenti", new { id = userId })">
                                        <img src="https://alipg.altervista.org/TailTales/settings.svg" alt="Settings" height="45" type="image/svg+xml" />
                                    </a>
                                    <p>Impostazioni</p>
                                }
                                else
                                {
                                    <a class="navbar-brand py-0" href="@Url.Action("Login", "Utenti", new { area = "" })">
                                        <img src="https://alipg.altervista.org/TailTales/login.svg" alt="Settings" height="32" type="image/svg+xml" />
                                    </a>
                                    <p>Entra</p>
                                }

                            }

                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- 2. Navbar -->
        <nav id="main-navbar" class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <!-- Container wrapper -->
            <div class="container-fluid justify-content-around">
                <!-- Toggle button -->
                <button class="navbar-toggler" type="button" data-mdb-toggle="collapse"
                        data-mdb-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
                        aria-label="Toggle navigation">
                    Espandi
                </button>

                <!-- Logo -->
                <a class="navbar-brand py-0 px-1" href="@Url.Action("Index", "Home")">
                    <img src="https://alipg.altervista.org/TailTales/TTlogo.svg" alt="Logo" height="60" type="image/svg+xml" />
                </a>
                <!-- Search form -->
                <form class="d-none d-md-flex input-group w-auto my-auto pe-2 ms-auto" action="@Url.Action("Search", "Home", new { query = "" })">
                    <input autocomplete="off" type="search" class="me-1 form-control rounded"
                           placeholder='Cerca...' style="min-width: 220px" name="query" />
                    <button class="btn" type="submit"><img src="https://alipg.altervista.org/TailTales/search.svg" height="25" /></button>
                </form>

                <!-- Link dx -->
                <ul class="navbar-nav ms-auto d-flex flex-row py-2">
                    @if (User.IsInRole("Admin"))
                    {
                        <li class="nav-item mx-2">
                            <a href="@Url.Action("Index", "Utenti")">
                                <i class="bi bi-people dark-grey" style="font-size: 18.5pt"></i>
                            </a>
                        </li>
                    }
                    <li class="nav-item mx-2">
                        <a href="@Url.Action("Index", "RichiestaContatto")">
                            <img id="notifications-icon" src="https://alipg.altervista.org/TailTales/graybell.svg" height="32" />
                            <span id="pending-notification-count" class="badge bg-danger">0</span>
                        </a>
                    </li>

                    <li class="nav-item mx-2">
                        <a href="@Url.Action("Create", "Pet")">
                            <img src="https://alipg.altervista.org/TailTales/Add-pet.svg" height="32" />
                        </a>
                    </li>
                    <li class="nav-item mx-2">
                        <a href="@Url.Action("Create", "AlbumFoto")">
                            <img src="https://alipg.altervista.org/TailTales/add_pic.svg" height="32" />
                        </a>
                    </li>
                    <li class="nav-item mx-2">
                        <a href="@Url.Action("Logout", "Utenti")">
                            <img src="https://alipg.altervista.org/TailTales/logout.svg" height="32" />
                        </a>
                    </li>
                </ul>
            </div>
            <!-- Container wrapper -->
        </nav>
        <!-- fine Navbar -->
    </header>
    <!--3. Main-->
    <div id="main-content">
        <div class="contentbody">
            @RenderBody()
        </div>
    </div>
    <!--4. Footer-->
    <footer class="bg-light text-center text-lg-start fixed-bottom z-0 dark-grey">
        <div class="container px-1 py-1">
            <div class="row my-2 gx-2">
                    <!-- Colonna 1: Logo + socials -->
                    <div class="col-lg-2 col-md-1 mb-1 ms-5 align-content-md-center" >
                        <h5 class="mb-1"  style="font-size: 14pt">&copy; @DateTime.Now.Year - <span class="orange">Tail</span><span class="lightblue">Tales</span></h5>

                        <ul class="list-unstyled d-flex mb-0" style="font-size: 11.5pt">
                            <li class="ps-0 px-2">
                                <i class="bi bi-instagram orange"></i>
                            </li> 
                            <li class="px-2">
                                <i class="bi bi-facebook lightblue"></i>
                            </li>
                            <li class="px-2">
                                <i class="bi bi-twitter-x"></i>
                            </li>
                            <li class="px-2">
                                <a href="#!" class=" dark-grey"><i class="bi bi-github pink"></i></a>
                            </li>
                        </ul>
                    </div>
                    <!--Colonna 3-->
                    <div class="col-lg-2 col-md-1 mb-2 mb-md-0">
                        <ul class="list-unstyled py-2 mb-0"  style="font-size: 11px">
                            <li>
                                <a href="@Url.Action("About")" class=" dark-grey">About</a>
                            </li>
                            <li>
                                <a href="@Url.Action("WorkWithUs")" class=" dark-grey">Lavora con noi</a>
                            </li>
                        </ul>
                    </div>
                    <!--Colonna 4-->
                    <div class="col-lg-2 col-md-1 mb-2 mb-md-0">
                        <ul class="list-unstyled py-2 mb-0" style="font-size: 11px">
                            <li>
                                <a href="@Url.Action("SiteGuide")" class=" dark-grey">Guida al sito</a>
                            </li>
                            <li>
                                <a href="@Url.Action("Help")" class=" dark-grey">Help/FAQ</a>
                            </li>
                        </ul>
                    </div>
                    <!--Colonna 5-->
                    <div class="col-lg-2 col-md-1 mb-2 mb-md-0" style="font-size: 11px">
                        <ul class="list-unstyled py-2  mb-0">
                            <li>
                                <a href="@Url.Action("Service")" class=" dark-grey">Termini di servizio</a>
                            </li>
                            <li>
                                <a href="@Url.Action("Cookies")" class=" dark-grey">Cookies</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
    </footer>
    <!-- End of .container -->
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
<script> 
    // Funzione per caricare il conteggio delle richieste di contatto in attesa
    // si collega alla action GetPendingRequests in RichiestaContattoController
    // Restituisce e aggiorna il conteggio delle richieste in attesa nel badge all'avvio della pagina
    $(document).ready(function() {
   
    function loadPendingRequestsCount() {
        $.ajax({
            url: '@Url.Action("GetPendingRequests", "RichiestaContatto")',
            type: 'GET',
            success: function(data) {
                // Aggiorna il conteggio delle richieste pendenti nel badge
                $('#pending-notification-count').text(data);
            },
            error: function(xhr, status, error) {
                console.error('Errore durante il caricamento del conteggio delle richieste pendenti:', error);
            }
        });
    }
    loadPendingRequestsCount();
});


</script>
</body>
</html>